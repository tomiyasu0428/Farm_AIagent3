# アグリAIエージェント 開発タスクリスト

> 2025-07-17 時点。`[ ]` 未着手 / `[~]` 進行中 / `[x]` 完了

---
## Phase 0 – 基盤構築 ✅ **完了**
- [x] P0 環境セットアップ（Next.js + FastAPI + MongoDB Atlas）
- [x] P12 LangChain エージェント基盤（MongoDB ツール + LLM）
- [x] P13 LINE Webhook 基盤（署名検証 & FastAPI Endpoint）
- [ ] P1 認証 & 読み取り専用ダッシュボード雛形

## Phase 1 – タスク管理 & AI 基本機能 ✅ **完了**
- [ ] P2 Tasks / Calendar CRUD 実装（API + MUI Calendar）
- [ ] P3 MongoDB Change Streams → LINE Push 通知
- [x] P14 TaskLookup / TaskUpdate Tool 実装
- [x] P19 FieldInfo / CropMaterial Tool 実装
- [x] P15 作業提案ロジック（農薬ローテーション & 天候）
- [x] P20 LangChainツール非同期処理問題解決
- [x] P21 LINEBOTイベントループ競合問題解決
- [x] P22 FieldAgent分離アーキテクチャ実装
- [x] P23 動的圃場名抽出システム構築
- [x] P24 LINE表示改善（ha単位、具体的実行プラン）
- [ ] P16 150 ユーザークエリで QA テスト

## Phase 2 – マスター管理
- [ ] P4 圃場・作物・資材マスター CRUD UI
- [ ] P5 workers コレクション実装 & LINE ID 紐付け

## Phase 3 – 在庫 & 発注、パフォーマンス最適化
- [ ] P6 Inventory & purchase_orders 管理モジュール
- [ ] P17 AI エージェント応答パフォーマンス最適化

## Phase 4 – 分析 & セキュリティ
- [ ] P7 KPI / Analytics ダッシュボード
- [ ] P18 セキュリティ強化（AuthZ, RateLimiting, Logging）

## Phase 5 – センサ & 自動化
- [ ] P8 sensor_logs 可視化 & アラート設定
- [ ] P9 notifications / schedule_rules UI & 自動タスク生成

## 共通タスク
- [ ] P10 ステージング環境デプロイ & UAT
- [ ] P11 ユーザーマニュアル・技術ドキュメント整備

---

## 最新の実装済み機能 (2025-07-17)

### 🤖 LangChain AIエージェント
- **Google Gemini 2.5 Flash**による自然言語処理
- **LangSmithトレーシング**による詳細な実行ログ
- **5つのLangChainツール**が完全動作

### 📱 LINE Bot機能
- **TaskLookupTool**: 「明日のタスクは？」「TASK-002について教えて」
- **TaskUpdateTool**: 「防除作業が完了しました」「明日の作業を延期」
- **FieldInfoTool**: 「第1ハウスの状況」「全圃場の状態」
- **CropMaterialTool**: 「ダコニール1000の希釈倍率」「トマトに使える農薬」
- **WorkSuggestionTool**: 「農薬ローテーション提案」「雨の日の作業」
- **FieldAgentTool**: 「圃場情報専門エージェント」（情報取得・検索）
- **FieldRegistrationAgentTool**: 「圃場登録専門エージェント」（新規登録・追加）

### 🗃️ データベース設計
- **MongoDB Atlas**による13コレクション設計
- **async/await**完全対応
- **イベントループ競合問題**完全解決

### 🔧 技術的解決事項
- **非同期処理の安定化**: 全ツールでエラーゼロ
- **データベース接続最適化**: 独立接続方式
- **LINEメッセージ処理**: 完全非同期化
- **FieldAgent分離アーキテクチャ**: 単一責任原則の実現
- **動的圃場名抽出**: データベースベース5段階抽出システム
- **LINE表示改善**: ha単位表示、具体的実行プランの生成

## 次期開発予定

### 🎯 Phase 1 最新成果（2025-07-23）
- ✅ **FieldAgent分離アーキテクチャ**: MasterAgent + 専門エージェント連携
- ✅ **動的圃場名抽出システム**: データベースベース5段階抽出（完全一致→部分一致→あいまい一致→正規表現→失敗）
- ✅ **単一責任原則の実現**: 各エージェントが専門分野に特化
- ✅ **LINE表示改善**: ha単位表示、具体的実行プランの生成
- ✅ **信頼度ベース判定システム**: 抽出結果の信頼度による品質管理

### 📊 Phase 2 計画
- マスターデータ管理UI
- ワーカー管理とLINE ID紐付け
- 高度な分析機能
- 在庫・発注管理システム